<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Complex filter | The REST API cookbook</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="I need a way to handle calls that contains many parameters in URL">
    
    <link rel="preload" href="/cookbook/assets/css/0.styles.61efb392.css" as="style"><link rel="preload" href="/cookbook/assets/js/app.5e792f52.js" as="script"><link rel="preload" href="/cookbook/assets/js/3.9f6d8892.js" as="script"><link rel="preload" href="/cookbook/assets/js/1.58ef23db.js" as="script"><link rel="preload" href="/cookbook/assets/js/13.9bf64610.js" as="script"><link rel="prefetch" href="/cookbook/assets/js/10.23a6cb12.js"><link rel="prefetch" href="/cookbook/assets/js/11.9041e3c5.js"><link rel="prefetch" href="/cookbook/assets/js/12.52c41b56.js"><link rel="prefetch" href="/cookbook/assets/js/14.45cb85e4.js"><link rel="prefetch" href="/cookbook/assets/js/15.6171fe55.js"><link rel="prefetch" href="/cookbook/assets/js/16.355f33df.js"><link rel="prefetch" href="/cookbook/assets/js/17.9de16ccb.js"><link rel="prefetch" href="/cookbook/assets/js/18.2d5ad787.js"><link rel="prefetch" href="/cookbook/assets/js/19.1e25c1bb.js"><link rel="prefetch" href="/cookbook/assets/js/20.233ff95d.js"><link rel="prefetch" href="/cookbook/assets/js/21.3176fa0b.js"><link rel="prefetch" href="/cookbook/assets/js/22.b56a20e8.js"><link rel="prefetch" href="/cookbook/assets/js/23.2e3d0a13.js"><link rel="prefetch" href="/cookbook/assets/js/4.f8125ee1.js"><link rel="prefetch" href="/cookbook/assets/js/5.4113af5c.js"><link rel="prefetch" href="/cookbook/assets/js/6.b29b864a.js"><link rel="prefetch" href="/cookbook/assets/js/7.6dafa1e9.js"><link rel="prefetch" href="/cookbook/assets/js/8.1b37a035.js"><link rel="prefetch" href="/cookbook/assets/js/9.2139fb15.js">
    <link rel="stylesheet" href="/cookbook/assets/css/0.styles.61efb392.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cookbook/" class="home-link router-link-active"><!----> <span class="site-name">The REST API cookbook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="complex-filter"><a href="#complex-filter" class="header-anchor">#</a> Complex filter</h1> <h2 id="use-case"><a href="#use-case" class="header-anchor">#</a> Use-case</h2> <p>On any APIs where there is a need to fetch resources, there is also a need to filter these using search criteria.
In most cases, these criteria are present in the url as query params.
It can be tempting to shorten the request by using shortens or code to describe your search criterias, ending up with something like:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>GET https://api.example.com/v1/products?page<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">5</span><span class="token operator">&amp;</span><span class="token assign-left variable">productType</span><span class="token operator">=</span>type1<span class="token operator">&amp;</span><span class="token assign-left variable">productType</span><span class="token operator">=</span>type2<span class="token operator">&amp;</span><span class="token assign-left variable">productType</span><span class="token operator">=</span>type3<span class="token operator">&amp;</span><span class="token assign-left variable">brand</span><span class="token operator">=</span>brand1<span class="token operator">&amp;</span><span class="token assign-left variable">brand</span><span class="token operator">=</span>brand2<span class="token operator">&amp;</span><span class="token punctuation">..</span>.
</code></pre></div><p>In this case, the request is even less readable, you will need a very strong documentation and you may end up developping dictionnaries to list all those codes.
Also, it may exceed the maximum length of the URL (depending on the browser).</p> <p>And in the case where there are nested parameters, long series of values for one criterion, how can we handle it?</p> <p>So what can we do about all of this? Let's look at the following recipes.</p> <h2 id="recipe-1-use-a-different-request-method-verb-post"><a href="#recipe-1-use-a-different-request-method-verb-post" class="header-anchor">#</a> Recipe 1: use a different request method, verb POST</h2> <p>It may seem confusing but keep in mind that an endpoint either may or may not return (GET) or accept (POST/PUT)/... resources.</p> <p>In <a href="http://www.rfcreader.com/#rfc2616_line2483" target="_blank" rel="noopener noreferrer">RFC 2616<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, it is defined that with POST, the data sent may not result in the creation of a new resource.</p> <p>Using the HTTP verb POST, creates an endpoint which accepts a request body that contains the Search Criteria.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>POST https://api.example.com/v1/products/search HTTP/1.1
<span class="token punctuation">{</span>
    <span class="token string">&quot;page&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">&quot;limit&quot;</span><span class="token builtin class-name">:</span> <span class="token number">15</span>,
    <span class="token string">&quot;productType&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;type1&quot;</span>,
        <span class="token string">&quot;type2&quot;</span>,
        <span class="token string">&quot;type3&quot;</span>
    <span class="token punctuation">]</span>,
    <span class="token string">&quot;brand&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;brand1&quot;</span>,
        <span class="token string">&quot;brand2&quot;</span>
    <span class="token punctuation">]</span>,
    <span class="token string">&quot;otherSearchCriteria&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span> <span class="token number">200</span> OK
<span class="token operator">&lt;</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
<span class="token operator">&lt;</span>     <span class="token punctuation">..</span>.
<span class="token operator">&lt;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>This endpoint will not create any resource but will return the result of the search with the sent criteria.</p> <h3 id="benefits-and-drawbacks"><a href="#benefits-and-drawbacks" class="header-anchor">#</a> Benefits and drawbacks</h3> <p>Benefits:</p> <ul><li>endpoint is readable because the Search Criteria is structured</li> <li>handle more complex search criteria, ex: nested parameters, array</li> <li>will never reach the maximum length of the URL</li></ul> <p>Drawbacks:</p> <ul><li>because it's not common to use a POST like this, consumers need to know all the specifications in order to use this endpoint such as the body of Search Criteria</li> <li>cannot share a link to make the same search</li> <li>not recommended if the request body can not be easily retrieved (e.g. from a log monitor)
<ul><li>it will be hard to reproduce the request</li></ul></li> <li>responses to POST are not target of caching operations, HTTP caches are limited to caching responses to GET
<ul><li>it may be possible to cache responses to POST, but it will be difficult</li></ul></li></ul> <h2 id="recipe-2-put-an-object-into-an-url-parameter"><a href="#recipe-2-put-an-object-into-an-url-parameter" class="header-anchor">#</a> Recipe 2: put an object into an URL parameter</h2> <p>Where is this recipe used? In Grafana, Kibana, Amazon (e-commerce)...</p> <p>Using the HTTP verb GET, creates an endpoint which accepts an object (JSON, XML,...) in the url parameter.</p> <p>At first, it will look like this because the object will be encoded.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>GET https://api.example.com/v1/products?searchCriteria<span class="token operator">=</span>%7B%22page%22%3A1%2C%22limit%22%3A15%2C%22productType%22%3A%5B%22type1%22%2C%22type2%22%2C%22type3%22%5D%2C%22brand%22%3A%5B%22brand1%22%2C%22brand2%22%5D%2C%22otherSearchCriteria%22%3A<span class="token punctuation">..</span>.%7D HTTP/1.1
<span class="token operator">&lt;</span> <span class="token number">200</span> OK
<span class="token operator">&lt;</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
<span class="token operator">&lt;</span>     <span class="token punctuation">..</span>.
<span class="token operator">&lt;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>But when decoded, it will look like this.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>GET https://api.example.com/v1/products?searchCriteria<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;page&quot;</span>:1,<span class="token string">&quot;limit&quot;</span>:15,<span class="token string">&quot;productType&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;type1&quot;</span>,<span class="token string">&quot;type2&quot;</span>,<span class="token string">&quot;type3&quot;</span><span class="token punctuation">]</span>,<span class="token string">&quot;brand&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;brand1&quot;</span>,<span class="token string">&quot;brand2&quot;</span><span class="token punctuation">]</span>,<span class="token string">&quot;otherSearchCriteria&quot;</span>:<span class="token punctuation">..</span>.<span class="token punctuation">}</span> HTTP/1.1
<span class="token operator">&lt;</span> <span class="token number">200</span> OK
<span class="token operator">&lt;</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
<span class="token operator">&lt;</span>     <span class="token punctuation">..</span>.
<span class="token operator">&lt;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>When receiving the request, the API must decode the url parameters to interpret it.</p> <h3 id="benefits-and-drawbacks-2"><a href="#benefits-and-drawbacks-2" class="header-anchor">#</a> Benefits and drawbacks</h3> <p>Benefits:</p> <ul><li>the parameters are structured in an object</li> <li>handle more complex search criteria, ex: nested parameters, array</li> <li>reduces the number of occurrences of query params</li> <li>responses to GET can be cached by a browser, proxy, cdn, gateway...</li></ul> <p>Drawbacks:</p> <ul><li>url is not readable</li> <li>there is a need to decode the url parameters</li> <li>it should not be abused, it should be used for the most complex endpoints
<ul><li>in case this method is used, there may be a need to reconsider the design
(the reason is trying to do too many things with this endpoint)</li></ul></li></ul> <h2 id="recipe-3-use-of-delimiters-within-a-query-param"><a href="#recipe-3-use-of-delimiters-within-a-query-param" class="header-anchor">#</a> Recipe 3: use of delimiters within a query param</h2> <p>Instead of having multiple query params for one parameter, delimiters can be used within a single query param.</p> <p>Using the example in the use-case with a delimiter like <code>,</code>, it will look like:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>GET https://api.example.com/v1/products?page<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">5</span><span class="token operator">&amp;</span><span class="token assign-left variable">productType</span><span class="token operator">=</span>type1,type2,type3<span class="token operator">&amp;</span><span class="token assign-left variable">brand</span><span class="token operator">=</span>brand1,brand2<span class="token punctuation">..</span>.
</code></pre></div><p>But it will only work on string query params.</p> <p>Plus in the API side, there will be a need to parse the query params <code>productType</code> &amp; <code>brand</code> by the delimiter.</p> <h3 id="benefits-and-drawbacks-3"><a href="#benefits-and-drawbacks-3" class="header-anchor">#</a> Benefits and drawbacks</h3> <p>Benefits:</p> <ul><li>reduces the number of occurrences of query params</li> <li>enhances readability</li></ul> <p>Drawbacks:</p> <ul><li>consumers need to know the specifications</li> <li>limited use on string query params</li> <li>need to choose a delimiter that will not hinder the readability
<ul><li><code>,</code> is OK</li> <li><code>;</code> <code>|</code> <code>&amp;</code> are reserved characters and can not be used</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/cookbook/assets/js/app.5e792f52.js" defer></script><script src="/cookbook/assets/js/3.9f6d8892.js" defer></script><script src="/cookbook/assets/js/1.58ef23db.js" defer></script><script src="/cookbook/assets/js/13.9bf64610.js" defer></script>
  </body>
</html>
